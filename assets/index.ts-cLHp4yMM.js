import{Y as m,w as h,L as I,x as i,U as b,D as E}from"./utils-B7UC0r1i.js";chrome.storage.local.clear();chrome.runtime.onMessage.addListener(async(t,a)=>{var e,o,s;switch(t.type){case I.AUTH_RECEIVED:{chrome.storage.local.set({isAuthenticated:t.isAuthenticated});break}case"CONTENT_LOADED":{const c=(e=a==null?void 0:a.tab)==null?void 0:e.id;c&&chrome.tabs.sendMessage(c,{type:"OPEN_POPUP",payload:"VERIFY_ORIGIN"});break}case"NO_AUTH_TRY_AGAIN":{const c=(o=a==null?void 0:a.tab)==null?void 0:o.id;c&&chrome.tabs.sendMessage(c,{type:"OPEN_POPUP",payload:"VERIFY_ORIGIN"});break}case"VERIFY_ORIGIN":{const c=(s=a==null?void 0:a.tab)==null?void 0:s.id;if(c){const{origin:l}=await chrome.storage.local.get("origin")??{};l&&chrome.tabs.sendMessage(c,{type:"OPEN_POPUP",payload:"ORIGIN_VERIFIED"})}break}case"CLEAR_ORIGIN":{chrome.storage.local.remove("origin");break}case"OPEN_FEEDBACK":{chrome.tabs.create({url:h});break}case"OPEN_FAQ_VIDEO":{chrome.tabs.create({url:m});break}}});const O=t=>new URL(t).hostname,u=(t,a)=>{const e=O(a);for(const o of t)if(e===o||e.endsWith(o))return!0;return!1},r=t=>(t?chrome.action.setIcon({path:"logo-128-bw.png"}):chrome.action.setIcon({path:"logo-128.png"}),t),n=async()=>{var o;const t={active:!0,currentWindow:!0},a=await chrome.tabs.query(t);if(a.length===0)return chrome.action.disable();const e=(o=a[0])==null?void 0:o.url;return!e||!u(E,e)?r(!0):r(!1)};chrome.tabs.onUpdated.addListener(async()=>{n()});chrome.tabs.onActivated.addListener(async()=>{n()});chrome.runtime.onInstalled.addListener(async()=>{const t=await i();if(t){const a=typeof t=="string"?+t.split("::")[0]:t;chrome.storage.local.set({origin:!0}),await chrome.tabs.reload(a)}});chrome.action.onClicked.addListener(async()=>{const t=await i();if(t){if(chrome.storage.local.set({origin:!0}),typeof t=="string")return;chrome.tabs.sendMessage(t,{type:"OPEN_POPUP",payload:"ORIGIN_VERIFIED"})}});chrome.runtime.setUninstallURL(b);
